<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ELADEB-R Auto-évaluation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .hidden { display: none; }
        .domain-list { list-style: none; padding: 0; }
        .domain-item { margin-bottom: 10px; }
        .chart-bar { background: #4CAF50; height: 20px; margin: 2px 0; }
        .chart-bar.need { background: #2196F3; }
    </style>
</head>
<body>
<h1>ELADEB-R Auto-évaluation</h1>
<div id="step-container"></div>
<script>
const domains = [
    "Lieu de vie", "Finances", "Travail", "Droit & justice",
    "Temps libre", "Tâches administratives", "Entretien du ménage", "Déplacements", "Fréquentation des lieux publics",
    "Connaissances et amitiés", "Famille", "Enfants", "Relations sentimentales",
    "Alimentation", "Hygiène personnelle", "Santé physique", "Santé psychique", "Addiction", "Traitement", "Spiritualité & croyances",
    "Sexualité"
];
const data = {
    initialQuestion: '',
    difficulties: domains.map(() => ({presence:false, intensity:0})),
    needs: domains.map(() => ({presence:false, urgency:0, origin:'?'})),
    priority:''
};
let currentStep = 0;
const container = document.getElementById('step-container');

function nextStep() {
    currentStep++;
    render();
}

function render() {
    container.innerHTML = '';
    if (currentStep === 0) renderInitialQuestion();
    else if (currentStep === 1) renderDifficultyPresence();
    else if (currentStep === 2) renderDifficultyIntensity();
    else if (currentStep === 3) renderNeedPresence();
    else if (currentStep === 4) renderNeedUrgency();
    else if (currentStep === 5) renderNeedOrigin();
    else if (currentStep === 6) renderPriority();
    else renderResults();
}

function renderInitialQuestion() {
    const div = document.createElement('div');
    div.innerHTML = '<p>Quel est pour vous le problème le plus important actuellement ?</p>' +
        '<textarea id="question" rows="3" cols="60"></textarea><br>' +
        '<button id="next">Suivant</button>';
    container.appendChild(div);
    document.getElementById('next').onclick = () => {
        data.initialQuestion = document.getElementById('question').value;
        nextStep();
    };
}

function renderDifficultyPresence() {
    const form = document.createElement('div');
    form.innerHTML = '<h2>Difficultés : ces domaines posent-ils problème ?</h2>';
    domains.forEach((d, i) => {
        const div = document.createElement('div');
        div.className = 'domain-item';
        div.innerHTML = `<strong>${d}</strong> ` +
            `<label><input type="radio" name="diff${i}" value="yes"> Problème</label> ` +
            `<label><input type="radio" name="diff${i}" value="no" checked> Pas de problème</label>`;
        form.appendChild(div);
    });
    const btn = document.createElement('button');
    btn.textContent = 'Suivant';
    btn.onclick = () => {
        domains.forEach((d, i) => {
            const val = document.querySelector(`input[name=diff${i}]:checked`).value;
            data.difficulties[i].presence = val === 'yes';
            if (!data.difficulties[i].presence) data.difficulties[i].intensity = 0;
        });
        nextStep();
    };
    form.appendChild(btn);
    container.appendChild(form);
}

function renderDifficultyIntensity() {
    const form = document.createElement('div');
    form.innerHTML = '<h2>Difficultés : importance des problèmes</h2>';
    domains.forEach((d, i) => {
        if (!data.difficulties[i].presence) return;
        const div = document.createElement('div');
        div.className = 'domain-item';
        div.innerHTML = `<strong>${d}</strong> ` +
            `<label><input type="radio" name="int${i}" value="1" checked> Peu important</label> ` +
            `<label><input type="radio" name="int${i}" value="2"> Important</label> ` +
            `<label><input type="radio" name="int${i}" value="3"> Très important</label>`;
        form.appendChild(div);
    });
    const btn = document.createElement('button');
    btn.textContent = 'Suivant';
    btn.onclick = () => {
        domains.forEach((d, i) => {
            if (!data.difficulties[i].presence) return;
            const val = document.querySelector(`input[name=int${i}]:checked`).value;
            data.difficulties[i].intensity = parseInt(val, 10);
        });
        nextStep();
    };
    form.appendChild(btn);
    container.appendChild(form);
}

function renderNeedPresence() {
    const form = document.createElement('div');
    form.innerHTML = '<h2>Besoin d\'aide supplémentaire ?</h2>';
    domains.forEach((d, i) => {
        const div = document.createElement('div');
        div.className = 'domain-item';
        div.innerHTML = `<strong>${d}</strong> ` +
            `<label><input type="radio" name="need${i}" value="yes"> Besoin</label> ` +
            `<label><input type="radio" name="need${i}" value="no" checked> Pas besoin</label>`;
        form.appendChild(div);
    });
    const btn = document.createElement('button');
    btn.textContent = 'Suivant';
    btn.onclick = () => {
        domains.forEach((d, i) => {
            const val = document.querySelector(`input[name=need${i}]:checked`).value;
            data.needs[i].presence = val === 'yes';
            if (!data.needs[i].presence) { data.needs[i].urgency = 0; data.needs[i].origin = '?'; }
        });
        nextStep();
    };
    form.appendChild(btn);
    container.appendChild(form);
}

function renderNeedUrgency() {
    const form = document.createElement('div');
    form.innerHTML = '<h2>Urgence de l\'aide souhaitée</h2>';
    domains.forEach((d, i) => {
        if (!data.needs[i].presence) return;
        const div = document.createElement('div');
        div.className = 'domain-item';
        div.innerHTML = `<strong>${d}</strong> ` +
            `<label><input type="radio" name="urg${i}" value="1" checked> Non urgent</label> ` +
            `<label><input type="radio" name="urg${i}" value="2"> Moyennement urgent</label> ` +
            `<label><input type="radio" name="urg${i}" value="3"> Urgent</label>`;
        form.appendChild(div);
    });
    const btn = document.createElement('button');
    btn.textContent = 'Suivant';
    btn.onclick = () => {
        domains.forEach((d, i) => {
            if (!data.needs[i].presence) return;
            const val = document.querySelector(`input[name=urg${i}]:checked`).value;
            data.needs[i].urgency = parseInt(val, 10);
        });
        nextStep();
    };
    form.appendChild(btn);
    container.appendChild(form);
}

function renderNeedOrigin() {
    const form = document.createElement('div');
    form.innerHTML = '<h2>Origine de l\'aide souhaitée</h2>';
    domains.forEach((d, i) => {
        if (!data.needs[i].presence) return;
        const div = document.createElement('div');
        div.className = 'domain-item';
        div.innerHTML = `<strong>${d}</strong> ` +
            `<select id="orig${i}">` +
            `<option value="P">Professionnels</option>` +
            `<option value="F">Famille</option>` +
            `<option value="E">Entourage</option>` +
            `<option value="?" selected>Non précisé</option>` +
            `</select>`;
        form.appendChild(div);
    });
    const btn = document.createElement('button');
    btn.textContent = 'Suivant';
    btn.onclick = () => {
        domains.forEach((d, i) => {
            if (!data.needs[i].presence) return;
            const val = document.getElementById(`orig${i}`).value;
            data.needs[i].origin = val;
        });
        nextStep();
    };
    form.appendChild(btn);
    container.appendChild(form);
}

function renderPriority() {
    const div = document.createElement('div');
    div.innerHTML = '<h2>Besoin prioritaire</h2>' +
        '<p>Si on ne pouvait faire qu\'une seule chose pour vous, laquelle choisiriez-vous ?</p>' +
        '<textarea id="priority" rows="3" cols="60"></textarea><br>' +
        '<button id="next">Terminer</button>';
    container.appendChild(div);
    document.getElementById('next').onclick = () => {
        data.priority = document.getElementById('priority').value;
        nextStep();
    };
}

function renderResults() {
    const div = document.createElement('div');
    div.innerHTML = '<h2>Résultats</h2>';
    const table = document.createElement('table');
    const header = '<tr><th>Domaine</th><th>Intensité difficulté</th><th>Urgence besoin</th><th>Origine</th></tr>';
    table.innerHTML = header + domains.map((d, i) => {
        const diff = data.difficulties[i].intensity;
        const need = data.needs[i].urgency;
        const orig = data.needs[i].origin;
        return `<tr><td>${d}</td><td>${diff}</td><td>${need}</td><td>${orig}</td></tr>`;
    }).join('');
    div.appendChild(table);

    const canvas = document.createElement('canvas');
    canvas.width = 600;
    canvas.height = domains.length * 25 + 20;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#eee';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    domains.forEach((d, i) => {
        const y = i*25 + 15;
        ctx.fillStyle = '#000';
        ctx.fillText(d, 10, y);
        ctx.fillStyle = '#4CAF50';
        ctx.fillRect(200, y-10, data.difficulties[i].intensity*40, 10);
        ctx.fillStyle = '#2196F3';
        ctx.fillRect(200 + 150, y-10, data.needs[i].urgency*40, 10);
    });
    div.appendChild(canvas);
    container.appendChild(div);
}

render();
</script>
</body>
</html>
